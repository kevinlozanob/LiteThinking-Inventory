

========================================
RUTA: docker-compose.yml
========================================
version: '3.8'

services:
  db:
    image: postgres:15-alpine
    container_name: prueba_fe_db
    environment:
      - POSTGRES_DB=prueba_fe_db
      - POSTGRES_USER=postgres
      - POSTGRES_PASSWORD=postgres
    ports:
      - "5432:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data

volumes:
  postgres_data:


========================================
RUTA: backend\manage.py
========================================
#!/usr/bin/env python
"""Django's command-line utility for administrative tasks."""
import os
import sys


def main():
    """Run administrative tasks."""
    os.environ.setdefault("DJANGO_SETTINGS_MODULE", "config.settings")
    try:
        from django.core.management import execute_from_command_line
    except ImportError as exc:
        raise ImportError(
            "Couldn't import Django. Are you sure it's installed and "
            "available on your PYTHONPATH environment variable? Did you "
            "forget to activate a virtual environment?"
        ) from exc
    execute_from_command_line(sys.argv)


if __name__ == "__main__":
    main()



========================================
RUTA: backend\config\asgi.py
========================================
"""
ASGI config for config project.

It exposes the ASGI callable as a module-level variable named ``application``.

For more information on this file, see
https://docs.djangoproject.com/en/6.0/howto/deployment/asgi/
"""

import os

from django.core.asgi import get_asgi_application

os.environ.setdefault("DJANGO_SETTINGS_MODULE", "config.settings")

application = get_asgi_application()



========================================
RUTA: backend\config\settings.py
========================================
from pathlib import Path
from decouple import config 
from datetime import timedelta

# Build paths inside the project like this: BASE_DIR / 'subdir'.
BASE_DIR = Path(__file__).resolve().parent.parent

# SECURITY WARNING: keep the secret key used in production secret!
SECRET_KEY = config('SECRET_KEY', default='django-insecure-dev-key')


DEBUG = config('DEBUG', default=True, cast=bool)

ALLOWED_HOSTS = []


# Application definition

INSTALLED_APPS = [
    "django.contrib.admin",
    "django.contrib.auth",
    "django.contrib.contenttypes",
    "django.contrib.sessions",
    "django.contrib.messages",
    "django.contrib.staticfiles",
    "rest_framework",
    "users",
    "core",
    'corsheaders',
]

REST_FRAMEWORK = {
    'DEFAULT_AUTHENTICATION_CLASSES': (
        'rest_framework_simplejwt.authentication.JWTAuthentication',
    ),
    'DEFAULT_PERMISSION_CLASSES': [
        'rest_framework.permissions.IsAuthenticatedOrReadOnly',
    ],
}

SIMPLE_JWT = {
    'ACCESS_TOKEN_LIFETIME': timedelta(minutes=60), 
    'REFRESH_TOKEN_LIFETIME': timedelta(days=1),    
    'ROTATE_REFRESH_TOKENS': True,
    'BLACKLIST_AFTER_ROTATION': True,
    'AUTH_HEADER_TYPES': ('Bearer',),
}

MIDDLEWARE = [
    "django.middleware.security.SecurityMiddleware",
    "django.contrib.sessions.middleware.SessionMiddleware",
    "django.middleware.common.CommonMiddleware",
    "django.middleware.csrf.CsrfViewMiddleware",
    "django.contrib.auth.middleware.AuthenticationMiddleware",
    "django.contrib.messages.middleware.MessageMiddleware",
    "django.middleware.clickjacking.XFrameOptionsMiddleware",
    'corsheaders.middleware.CorsMiddleware',
]

ROOT_URLCONF = "config.urls"

TEMPLATES = [
    {
        "BACKEND": "django.template.backends.django.DjangoTemplates",
        "DIRS": [],
        "APP_DIRS": True,
        "OPTIONS": {
            "context_processors": [
                "django.template.context_processors.request",
                "django.contrib.auth.context_processors.auth",
                "django.contrib.messages.context_processors.messages",
            ],
        },
    },
]

WSGI_APPLICATION = "config.wsgi.application"

# https://docs.djangoproject.com/en/6.0/ref/settings/#databases


DB_ENGINE = config('DB_ENGINE', default='sqlite')

if DB_ENGINE == 'postgres':
    DATABASES = {
        'default': {
            'ENGINE': 'django.db.backends.postgresql',
            'NAME': config('DB_NAME'),
            'USER': config('DB_USER'),
            'PASSWORD': config('DB_PASSWORD'),
            'HOST': config('DB_HOST'),
            'PORT': config('DB_PORT'),
        }
    }
else:
    DATABASES = {
        'default': {
            'ENGINE': 'django.db.backends.sqlite3',
            'NAME': BASE_DIR / 'db.sqlite3',
        }
    }


# Password validation
# https://docs.djangoproject.com/en/6.0/ref/settings/#auth-password-validators

AUTH_PASSWORD_VALIDATORS = [
    {
        "NAME": "django.contrib.auth.password_validation.UserAttributeSimilarityValidator",
    },
    {
        "NAME": "django.contrib.auth.password_validation.MinimumLengthValidator",
    },
    {
        "NAME": "django.contrib.auth.password_validation.CommonPasswordValidator",
    },
    {
        "NAME": "django.contrib.auth.password_validation.NumericPasswordValidator",
    },
]


# Internationalization
# https://docs.djangoproject.com/en/6.0/topics/i18n/

LANGUAGE_CODE = "es-co"

TIME_ZONE = "America/Bogota"

USE_I18N = True

USE_TZ = True


# Static files (CSS, JavaScript, Images)
# https://docs.djangoproject.com/en/6.0/howto/static-files/

STATIC_URL = "static/"

# Default primary key field type
# https://docs.djangoproject.com/en/6.0/ref/settings/#default-auto-field

DEFAULT_AUTO_FIELD = "django.db.models.BigAutoField"

AUTH_USER_MODEL = 'users.User'

CORS_ALLOWED_ORIGINS = [
    "http://localhost:5173",
    "http://127.0.0.1:5173",
]


========================================
RUTA: backend\config\urls.py
========================================
"""
URL configuration for config project.

The `urlpatterns` list routes URLs to views. For more information please see:
    https://docs.djangoproject.com/en/6.0/topics/http/urls/
Examples:
Function views
    1. Add an import:  from my_app import views
    2. Add a URL to urlpatterns:  path('', views.home, name='home')
Class-based views
    1. Add an import:  from other_app.views import Home
    2. Add a URL to urlpatterns:  path('', Home.as_view(), name='home')
Including another URLconf
    1. Import the include() function: from django.urls import include, path
    2. Add a URL to urlpatterns:  path('blog/', include('blog.urls'))
"""

from django.contrib import admin
from django.urls import path, include

urlpatterns = [
    path('admin/', admin.site.urls),
    path('api/', include('core.urls')),      
    path('api/auth/', include('users.urls')), 
]


========================================
RUTA: backend\config\wsgi.py
========================================
"""
WSGI config for config project.

It exposes the WSGI callable as a module-level variable named ``application``.

For more information on this file, see
https://docs.djangoproject.com/en/6.0/howto/deployment/wsgi/
"""

import os

from django.core.wsgi import get_wsgi_application

os.environ.setdefault("DJANGO_SETTINGS_MODULE", "config.settings")

application = get_wsgi_application()



========================================
RUTA: backend\config\__init__.py
========================================



========================================
RUTA: backend\core\admin.py
========================================
from django.contrib import admin
from .models import EmpresaModel, ProductoModel

@admin.register(EmpresaModel)
class EmpresaAdmin(admin.ModelAdmin):
    list_display = ('nit', 'nombre', 'telefono')
    search_fields = ('nombre', 'nit')

@admin.register(ProductoModel)
class ProductoAdmin(admin.ModelAdmin):
    list_display = ('codigo', 'nombre', 'empresa')
    list_filter = ('empresa',)
    search_fields = ('nombre', 'codigo')


========================================
RUTA: backend\core\ai.py
========================================
from decouple import config
from groq import Groq

def generar_descripcion_ia(nombre_producto, caracteristicas_basicas):

    api_key = config('GROQ_API_KEY', default=None)
    
    if not api_key:
        return "Error: API Key de Groq no configurada (Backend)."
        
    try:
        client = Groq(api_key=api_key)
        
        prompt = f"""
        ActÃºa como un experto en copywriting para e-commerce.
        Crea una descripciÃ³n corta, persuasiva y emocionante (mÃ¡ximo 40 palabras) para vender este producto:
        Nombre: {nombre_producto}
        CaracterÃ­sticas: {caracteristicas_basicas}
        
        IMPORTANTE: Responde SOLO con el texto plano. NO uses comillas en tu respuesta.

        """
        
        chat_completion = client.chat.completions.create(
             # Usamos Llama3 (versiÃ³n rÃ¡pida)
            messages=[{"role": "user", "content": prompt}],
            model="llama-3.3-70b-versatile",
        )
        
        return chat_completion.choices[0].message.content.strip()
        
    except Exception as e:
        return f"Error al consultar IA: {str(e)}"


========================================
RUTA: backend\core\apps.py
========================================
from django.apps import AppConfig


class CoreConfig(AppConfig):
    name = "core"



========================================
RUTA: backend\core\models.py
========================================
from django.db import models
from django.core.exceptions import ValidationError
from core_domain.entities.empresa import Empresa as EmpresaEntity
from core_domain.entities.producto import Producto as ProductoEntity

class EmpresaModel(models.Model):
    nit = models.CharField(max_length=50, primary_key=True, verbose_name="NIT")
    nombre = models.CharField(max_length=255, verbose_name="Nombre de la Empresa")
    direccion = models.CharField(max_length=255, verbose_name="DirecciÃ³n")
    telefono = models.CharField(max_length=20, verbose_name="TelÃ©fono")

    class Meta:
        verbose_name = "Empresa"
        verbose_name_plural = "Empresas"
        db_table = "empresas"

    def save(self, *args, **kwargs):
        try:
            EmpresaEntity(
                nit=self.nit,
                nombre=self.nombre,
                direccion=self.direccion,
                telefono=self.telefono
            )
        except ValueError as e:
            raise ValidationError(str(e))
            
        super().save(*args, **kwargs)

    def __str__(self):
        return f"{self.nombre} ({self.nit})"


class ProductoModel(models.Model):
    codigo = models.CharField(max_length=50, unique=True, verbose_name="CÃ³digo")
    nombre = models.CharField(max_length=255, verbose_name="Nombre del Producto")
    caracteristicas = models.TextField(verbose_name="CaracterÃ­sticas")
    
    empresa = models.ForeignKey(
        EmpresaModel, 
        on_delete=models.CASCADE, 
        related_name='productos',
        verbose_name="Empresa"
    )

    precios = models.JSONField(
        default=dict, 
        verbose_name="Precios (Moneda -> Valor)",
        help_text="Formato: {'USD': 100, 'COP': 400000}"
    )

    class Meta:
        verbose_name = "Producto"
        verbose_name_plural = "Productos"
        db_table = "productos"

    def save(self, *args, **kwargs):
        try:
            ProductoEntity(
                codigo=self.codigo,
                nombre=self.nombre,
                caracteristicas=self.caracteristicas,
                empresa_nit=self.empresa_id, # Usamos el ID, no el objeto Django
                precios=self.precios
            )
        except ValueError as e:
            raise ValidationError(str(e))
            
        super().save(*args, **kwargs)

    def __str__(self):
        return self.nombre


========================================
RUTA: backend\core\permissions.py
========================================
from rest_framework import permissions

class IsAdminOrReadOnly(permissions.BasePermission):


    def has_permission(self, request, view):
        if not request.user or not request.user.is_authenticated:
            return False
        if request.method in permissions.SAFE_METHODS:
            return True
        return request.user.is_staff


========================================
RUTA: backend\core\reports.py
========================================
import io
from reportlab.lib import colors
from reportlab.lib.pagesizes import letter
from reportlab.platypus import SimpleDocTemplate, Table, TableStyle, Paragraph
from reportlab.lib.styles import getSampleStyleSheet

def generar_pdf_inventario(productos):
    buffer = io.BytesIO()
    doc = SimpleDocTemplate(buffer, pagesize=letter)
    elements = []
    
    styles = getSampleStyleSheet()
    
    elements.append(Paragraph("Reporte de Inventario de Productos", styles['Title']))
    elements.append(Paragraph("<br/><br/>", styles['Normal']))
    
    data = [['CÃ³digo', 'Nombre', 'Empresa', 'Precio (Ref)']]
    
    for prod in productos:
        
        precio_str = "N/A"
        
        if isinstance(prod.precios, dict) and prod.precios:
            key = 'USD' if 'USD' in prod.precios else list(prod.precios.keys())[0]
            val = prod.precios[key]
            precio_str = f"{key} {val}"
        
        data.append([
            str(prod.codigo),
            str(prod.nombre)[:30],
            str(prod.empresa.nombre)[:20],
            precio_str
        ])
        
    table = Table(data)
    style = TableStyle([
        ('BACKGROUND', (0, 0), (-1, 0), colors.grey),
        ('TEXTCOLOR', (0, 0), (-1, 0), colors.whitesmoke),
        ('ALIGN', (0, 0), (-1, -1), 'CENTER'),
        ('FONTNAME', (0, 0), (-1, 0), 'Helvetica-Bold'),
        ('BOTTOMPADDING', (0, 0), (-1, 0), 12),
        ('BACKGROUND', (0, 1), (-1, -1), colors.beige),
        ('GRID', (0, 0), (-1, -1), 1, colors.black),
    ])
    table.setStyle(style)
    
    elements.append(table)
    doc.build(elements)
    buffer.seek(0)
    return buffer


========================================
RUTA: backend\core\serializers.py
========================================
from rest_framework import serializers
from .models import EmpresaModel, ProductoModel

class EmpresaSerializer(serializers.ModelSerializer):
    class Meta:
        model = EmpresaModel
        fields = '__all__'

class ProductoSerializer(serializers.ModelSerializer):
    
    class Meta:
        model = ProductoModel
        fields = '__all__'
        
    def validate_precios(self, value):

        if not isinstance(value, dict):
            raise serializers.ValidationError("El campo precios debe ser un objeto JSON (diccionario).")
        return value


========================================
RUTA: backend\core\tests.py
========================================
from django.test import TestCase

# Create your tests here.



========================================
RUTA: backend\core\urls.py
========================================
from django.urls import path, include
from rest_framework.routers import DefaultRouter
from .views import EmpresaViewSet, ProductoViewSet

router = DefaultRouter()
router.register(r'empresas', EmpresaViewSet)
router.register(r'productos', ProductoViewSet)

urlpatterns = [
    path('', include(router.urls)),
]


========================================
RUTA: backend\core\views.py
========================================
from rest_framework import viewsets
from rest_framework.permissions import IsAuthenticatedOrReadOnly
from rest_framework.decorators import action
from rest_framework.response import Response
from django.http import FileResponse

from .models import EmpresaModel, ProductoModel
from .serializers import EmpresaSerializer, ProductoSerializer


from .reports import generar_pdf_inventario   
from .ai import generar_descripcion_ia     
from .permissions import IsAdminOrReadOnly   

import requests 
import base64   
from decouple import config 

# --------------------------------------

class EmpresaViewSet(viewsets.ModelViewSet):
    queryset = EmpresaModel.objects.all()
    serializer_class = EmpresaSerializer
    permission_classes = [IsAdminOrReadOnly] 

class ProductoViewSet(viewsets.ModelViewSet):
    queryset = ProductoModel.objects.all()
    serializer_class = ProductoSerializer
    permission_classes = [IsAdminOrReadOnly]
    
    # Endpoint para bajar PDF
    @action(detail=False, methods=['get'])
    def descargar_reporte(self, request):
        productos = self.get_queryset()
        buffer = generar_pdf_inventario(productos)
        return FileResponse(buffer, as_attachment=True, filename='inventario.pdf')

    # Endpoint para AI
    @action(detail=False, methods=['post'])
    def generar_descripcion(self, request):
        nombre = request.data.get('nombre')
        caracteristicas = request.data.get('caracteristicas', '')
        
        if not nombre:
            return Response({"error": "Falta nombre del producto"}, status=400)
            
        texto = generar_descripcion_ia(nombre, caracteristicas)
        return Response({"descripcion": texto})
    @action(detail=False, methods=['post'])
    def enviar_reporte_email(self, request):

        email_destino = request.data.get('email')
        
        if not email_destino:
            return Response({"error": "Se requiere un email de destino"}, status=400)

        productos = self.get_queryset()
        pdf_buffer = generar_pdf_inventario(productos)
        
        pdf_content = pdf_buffer.getvalue()
        pdf_base64 = base64.b64encode(pdf_content).decode('utf-8')

        resend_api_key = config('RESEND_API_KEY', default='')
        sender_email = config('RESEND_FROM_EMAIL', default='') 

        if not resend_api_key:
             return Response({"error": "Falta configuraciÃ³n de API Key en servidor"}, status=500)

        url = "https://api.resend.com/emails"
        
        payload = {
            "from": f"Lite Thinking <{sender_email}>",
            "to": [email_destino],
            "subject": "Reporte de Inventario - Lite Thinking",
            "html": "<p>Adjunto encontrarÃ¡s el reporte actual del inventario generado automÃ¡ticamente.</p>",
            "attachments": [
                {
                    "content": pdf_base64,
                    "filename": "inventario.pdf",
                    "type": "application/pdf" #,
                    #"disposition": "attachment" 
                }
            ]
        }
        
        headers = {
            "Authorization": f"Bearer {resend_api_key}",
            "Content-Type": "application/json"
        }

        try:
            response = requests.post(url, json=payload, headers=headers)
            
            if response.status_code == 200:
                return Response({"message": "Correo enviado exitosamente", "id": response.json().get('id')})
            else:
                return Response({"error": f"Error en Resend: {response.text}"}, status=400)
                
        except Exception as e:
            return Response({"error": str(e)}, status=500)


========================================
RUTA: backend\core\__init__.py
========================================



========================================
RUTA: backend\users\admin.py
========================================
from django.contrib import admin

# Register your models here.



========================================
RUTA: backend\users\apps.py
========================================
from django.apps import AppConfig


class UsersConfig(AppConfig):
    name = "users"



========================================
RUTA: backend\users\models.py
========================================
from django.contrib.auth.models import AbstractBaseUser, BaseUserManager, PermissionsMixin
from django.db import models

class UserManager(BaseUserManager):
    def create_user(self, email, password=None, **extra_fields):
        if not email:
            raise ValueError('El usuario debe tener un correo electrÃ³nico')
        email = self.normalize_email(email)
        user = self.model(email=email, **extra_fields)
        user.set_password(password)
        user.save(using=self._db)
        return user

    def create_superuser(self, email, password=None, **extra_fields):
        extra_fields.setdefault('is_staff', True)
        extra_fields.setdefault('is_superuser', True)
        return self.create_user(email, password, **extra_fields)

class User(AbstractBaseUser, PermissionsMixin):
    email = models.EmailField(unique=True, verbose_name="Correo ElectrÃ³nico")
    is_active = models.BooleanField(default=True)
    is_staff = models.BooleanField(default=False) # Para saber si es Administrador

    objects = UserManager()

    USERNAME_FIELD = 'email'
    REQUIRED_FIELDS = []

    def __str__(self):
        return self.email


========================================
RUTA: backend\users\serializers.py
========================================
from rest_framework import serializers
from django.contrib.auth import get_user_model

User = get_user_model()

class UserRegistrationSerializer(serializers.ModelSerializer):
    password = serializers.CharField(write_only=True)

    class Meta:
        model = User
        fields = ('email', 'password')

    def create(self, validated_data):
        user = User.objects.create_user(
            email=validated_data['email'],
            password=validated_data['password']
        )
        return user


========================================
RUTA: backend\users\tests.py
========================================
from django.test import TestCase

# Create your tests here.



========================================
RUTA: backend\users\urls.py
========================================
from django.urls import path
from rest_framework_simplejwt.views import TokenRefreshView
from .views import UserRegistrationView, CustomLoginView

urlpatterns = [
    path('login/', CustomLoginView.as_view(), name='token_obtain_pair'),
    path('token/refresh/', TokenRefreshView.as_view(), name='token_refresh'),
    path('register/', UserRegistrationView.as_view(), name='register'),
]


========================================
RUTA: backend\users\views.py
========================================
from rest_framework import generics
from rest_framework.permissions import AllowAny
from .serializers import UserRegistrationSerializer

from rest_framework_simplejwt.views import TokenObtainPairView
from rest_framework_simplejwt.serializers import TokenObtainPairSerializer

class CustomTokenObtainPairSerializer(TokenObtainPairSerializer):
    def validate(self, attrs):
        data = super().validate(attrs)
        #internamente Django lo llama is_staff
        data['is_admin'] = self.user.is_staff 
        data['email'] = self.user.email
        return data
class CustomLoginView(TokenObtainPairView):
    serializer_class = CustomTokenObtainPairSerializer

class UserRegistrationView(generics.CreateAPIView):
    serializer_class = UserRegistrationSerializer
    permission_classes = [AllowAny]


========================================
RUTA: backend\users\__init__.py
========================================



========================================
RUTA: core-domain\pyproject.toml
========================================
[project]
name = "core-domain"
version = "0.1.0"
description = "Reglas de negocio y entidades"
authors = [
    {name = "kevinlozanob",email = "kevin.lozano-b@uniminuto.edu.co"}
]
readme = "README.md"
requires-python = "^3.10"
dependencies = [
]


[build-system]
requires = ["poetry-core>=2.0.0,<3.0.0"]
build-backend = "poetry.core.masonry.api"



========================================
RUTA: core-domain\README.md
========================================
# Core Domain



========================================
RUTA: core-domain\core_domain\__init__.py
========================================



========================================
RUTA: core-domain\core_domain\entities\empresa.py
========================================
from dataclasses import dataclass
from typing import Optional

@dataclass
class Empresa:
    nit: str
    nombre: str
    direccion: str
    telefono: str

    def __post_init__(self):
        if not self.nit:
            raise ValueError("El NIT es obligatorio para una empresa")


========================================
RUTA: core-domain\core_domain\entities\producto.py
========================================
from dataclasses import dataclass
from typing import Dict
from decimal import Decimal

@dataclass
class Producto:
# Representa un producto con sus detalles y precios en diferentes monedas.
    codigo: str
    nombre: str
    caracteristicas: str
    empresa_nit: str

    precios: Dict[str, Decimal]

    def __post_init__(self):
        if not self.codigo:
            raise ValueError("El cÃ³digo del producto es obligatorio")
        if not self.nombre:
            raise ValueError("El nombre del producto es obligatorio")
        if not self.empresa_nit:
            raise ValueError("Todo producto debe estar asociado a una empresa (NIT)")
        if not self.precios:
            raise ValueError("El producto debe tener al menos un precio asignado")

    def obtener_precio(self, moneda: str) -> Decimal:
        if moneda not in self.precios:
            raise ValueError(f"El producto no tiene precio configurado para {moneda}")
        return self.precios[moneda]


========================================
RUTA: core-domain\core_domain\entities\__init__.py
========================================
from .empresa import Empresa
from .producto import Producto


========================================
RUTA: frontend\eslint.config.js
========================================
import js from '@eslint/js'
import globals from 'globals'
import reactHooks from 'eslint-plugin-react-hooks'
import reactRefresh from 'eslint-plugin-react-refresh'
import tseslint from 'typescript-eslint'
import { defineConfig, globalIgnores } from 'eslint/config'

export default defineConfig([
  globalIgnores(['dist']),
  {
    files: ['**/*.{ts,tsx}'],
    extends: [
      js.configs.recommended,
      tseslint.configs.recommended,
      reactHooks.configs.flat.recommended,
      reactRefresh.configs.vite,
    ],
    languageOptions: {
      ecmaVersion: 2020,
      globals: globals.browser,
    },
  },
])



========================================
RUTA: frontend\index.html
========================================
<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>NicklcsDev - Lite Thinking</title>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>



========================================
RUTA: frontend\package.json
========================================
{
  "name": "frontend",
  "private": true,
  "version": "0.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "tsc -b && vite build",
    "lint": "eslint .",
    "preview": "vite preview"
  },
  "dependencies": {
    "@tailwindcss/postcss": "^4.1.18",
    "axios": "^1.13.2",
    "lucide-react": "^0.562.0",
    "react": "^19.2.0",
    "react-dom": "^19.2.0",
    "react-router-dom": "^7.12.0"
  },
  "devDependencies": {
    "@eslint/js": "^9.39.1",
    "@types/node": "^24.10.1",
    "@types/react": "^19.2.5",
    "@types/react-dom": "^19.2.3",
    "@vitejs/plugin-react": "^5.1.1",
    "autoprefixer": "^10.4.23",
    "eslint": "^9.39.1",
    "eslint-plugin-react-hooks": "^7.0.1",
    "eslint-plugin-react-refresh": "^0.4.24",
    "globals": "^16.5.0",
    "postcss": "^8.5.6",
    "tailwindcss": "^4.1.18",
    "typescript": "~5.9.3",
    "typescript-eslint": "^8.46.4",
    "vite": "^7.2.4"
  }
}



========================================
RUTA: frontend\postcss.config.js
========================================
export default {
  plugins: {
    '@tailwindcss/postcss': {},
    autoprefixer: {},
  },
}


========================================
RUTA: frontend\README.md
========================================
# React + TypeScript + Vite

This template provides a minimal setup to get React working in Vite with HMR and some ESLint rules.

Currently, two official plugins are available:

- [@vitejs/plugin-react](https://github.com/vitejs/vite-plugin-react/blob/main/packages/plugin-react) uses [Babel](https://babeljs.io/) (or [oxc](https://oxc.rs) when used in [rolldown-vite](https://vite.dev/guide/rolldown)) for Fast Refresh
- [@vitejs/plugin-react-swc](https://github.com/vitejs/vite-plugin-react/blob/main/packages/plugin-react-swc) uses [SWC](https://swc.rs/) for Fast Refresh

## React Compiler

The React Compiler is not enabled on this template because of its impact on dev & build performances. To add it, see [this documentation](https://react.dev/learn/react-compiler/installation).

## Expanding the ESLint configuration

If you are developing a production application, we recommend updating the configuration to enable type-aware lint rules:

```js
export default defineConfig([
  globalIgnores(['dist']),
  {
    files: ['**/*.{ts,tsx}'],
    extends: [
      // Other configs...

      // Remove tseslint.configs.recommended and replace with this
      tseslint.configs.recommendedTypeChecked,
      // Alternatively, use this for stricter rules
      tseslint.configs.strictTypeChecked,
      // Optionally, add this for stylistic rules
      tseslint.configs.stylisticTypeChecked,

      // Other configs...
    ],
    languageOptions: {
      parserOptions: {
        project: ['./tsconfig.node.json', './tsconfig.app.json'],
        tsconfigRootDir: import.meta.dirname,
      },
      // other options...
    },
  },
])
```

You can also install [eslint-plugin-react-x](https://github.com/Rel1cx/eslint-react/tree/main/packages/plugins/eslint-plugin-react-x) and [eslint-plugin-react-dom](https://github.com/Rel1cx/eslint-react/tree/main/packages/plugins/eslint-plugin-react-dom) for React-specific lint rules:

```js
// eslint.config.js
import reactX from 'eslint-plugin-react-x'
import reactDom from 'eslint-plugin-react-dom'

export default defineConfig([
  globalIgnores(['dist']),
  {
    files: ['**/*.{ts,tsx}'],
    extends: [
      // Other configs...
      // Enable lint rules for React
      reactX.configs['recommended-typescript'],
      // Enable lint rules for React DOM
      reactDom.configs.recommended,
    ],
    languageOptions: {
      parserOptions: {
        project: ['./tsconfig.node.json', './tsconfig.app.json'],
        tsconfigRootDir: import.meta.dirname,
      },
      // other options...
    },
  },
])
```



========================================
RUTA: frontend\tailwind.config.js
========================================
/** @type {import('tailwindcss').Config} */
export default {
  content: [
    "./index.html",
    "./src/**/*.{js,ts,jsx,tsx}",
  ],
  theme: {
    extend: {},
  },
  plugins: [],
}


========================================
RUTA: frontend\tsconfig.app.json
========================================
{
  "compilerOptions": {
    "tsBuildInfoFile": "./node_modules/.tmp/tsconfig.app.tsbuildinfo",
    "target": "ES2022",
    "useDefineForClassFields": true,
    "lib": ["ES2022", "DOM", "DOM.Iterable"],
    "module": "ESNext",
    "types": ["vite/client"],
    "skipLibCheck": true,

    /* Bundler mode */
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "verbatimModuleSyntax": true,
    "moduleDetection": "force",
    "noEmit": true,
    "jsx": "react-jsx",

    /* Linting */
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "erasableSyntaxOnly": true,
    "noFallthroughCasesInSwitch": true,
    "noUncheckedSideEffectImports": true
  },
  "include": ["src"]
}



========================================
RUTA: frontend\tsconfig.json
========================================
{
  "files": [],
  "references": [
    { "path": "./tsconfig.app.json" },
    { "path": "./tsconfig.node.json" }
  ]
}



========================================
RUTA: frontend\tsconfig.node.json
========================================
{
  "compilerOptions": {
    "tsBuildInfoFile": "./node_modules/.tmp/tsconfig.node.tsbuildinfo",
    "target": "ES2023",
    "lib": ["ES2023"],
    "module": "ESNext",
    "types": ["node"],
    "skipLibCheck": true,

    /* Bundler mode */
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "verbatimModuleSyntax": true,
    "moduleDetection": "force",
    "noEmit": true,

    /* Linting */
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "erasableSyntaxOnly": true,
    "noFallthroughCasesInSwitch": true,
    "noUncheckedSideEffectImports": true
  },
  "include": ["vite.config.ts"]
}



========================================
RUTA: frontend\vite.config.ts
========================================
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'

// https://vite.dev/config/
export default defineConfig({
  plugins: [react()],
})



========================================
RUTA: frontend\src\App.css
========================================
#root {
  max-width: 1280px;
  margin: 0 auto;
  padding: 2rem;
  text-align: center;
}

.logo {
  height: 6em;
  padding: 1.5em;
  will-change: filter;
  transition: filter 300ms;
}
.logo:hover {
  filter: drop-shadow(0 0 2em #646cffaa);
}
.logo.react:hover {
  filter: drop-shadow(0 0 2em #61dafbaa);
}

@keyframes logo-spin {
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
}

@media (prefers-reduced-motion: no-preference) {
  a:nth-of-type(2) .logo {
    animation: logo-spin infinite 20s linear;
  }
}

.card {
  padding: 2em;
}

.read-the-docs {
  color: #888;
}



========================================
RUTA: frontend\src\App.tsx
========================================
import { BrowserRouter, Routes, Route, Navigate } from 'react-router-dom';
import { AuthProvider, useAuth } from './context/AuthContext';
import Login from './pages/Login';
import Register from './pages/Register';
import Dashboard from './pages/Dashboard';
import InventoryPage from './pages/InventoryPage';

const ProtectedRoute = ({ children }: { children: JSX.Element }) => {
  const { isAuthenticated, isLoading } = useAuth();

  if (isLoading) return <div>Cargando...</div>;
  
  if (!isAuthenticated) {
    return <Navigate to="/login" replace />;
  }

  return children;
};

// Componente para redireccionar si ya estÃ¡ logueado
const PublicRoute = ({ children }: { children: JSX.Element }) => {
    const { isAuthenticated } = useAuth();
    if (isAuthenticated) {
        return <Navigate to="/dashboard" replace />;
    }
    return children;
}
function App() {
  return (
    <AuthProvider>
      <BrowserRouter>
        <Routes>
          {/* Ruta PÃºblica (Login)*/}
          <Route path="/login" element={
              <PublicRoute>
                  <Login />
              </PublicRoute>
          } />
          {/* Registro */}
           <Route path="/register" element={
              <PublicRoute>
                  <Register />
              </PublicRoute>
          } />
          {/* Ruta JWT (Dashboard) */}
          <Route path="/dashboard" element={
            <ProtectedRoute>
              <Dashboard />
            </ProtectedRoute>
          } />
          {/* NUEVA RUTA DINÃMICA */}
          <Route path="/dashboard/empresa/:nit" element={
            <ProtectedRoute>
              <InventoryPage />
            </ProtectedRoute>
          } />
          {/* Ruta defauly */}
          <Route path="*" element={<Navigate to="/login" replace />} />
        </Routes>
      </BrowserRouter>
    </AuthProvider>
  );
}

export default App;


========================================
RUTA: frontend\src\index.css
========================================
@import "tailwindcss";



========================================
RUTA: frontend\src\main.tsx
========================================
import React from 'react'
import ReactDOM from 'react-dom/client'
import App from './App.tsx'
import './index.css' 
import { ToastProvider } from './context/ToastContext.tsx' // <--- Importamos


ReactDOM.createRoot(document.getElementById('root')!).render(
  <React.StrictMode>
    <ToastProvider>  {/* <--- Envolvemos */}
      <App />
    </ToastProvider>
  </React.StrictMode>,
)


========================================
RUTA: frontend\src\components\atoms\Button.tsx
========================================
import React from 'react';

interface ButtonProps extends React.ButtonHTMLAttributes<HTMLButtonElement> {
  variant?: 'primary' | 'social';
  icon?: React.ReactNode;
}

export const Button = ({ children, className = '', variant = 'primary', icon, ...props }: ButtonProps) => {
  const baseStyles = "w-full rounded h-[46px] text-sm font-bold transition-all flex items-center justify-center gap-3";
  
  const variants = {
    primary: "bg-[#E6C200] text-black uppercase tracking-wide hover:bg-[#d4b000] active:scale-[0.98] mt-1",
    social: "bg-white text-gray-800 hover:bg-gray-100 border border-transparent"
  };

  return (
    <button className={`${baseStyles} ${variants[variant]} ${className}`} {...props}>
      {icon && <span className="w-5 h-5 flex items-center justify-center">{icon}</span>}
      {children}
    </button>
  );
};


========================================
RUTA: frontend\src\components\atoms\Input.tsx
========================================
import React from 'react';

interface InputProps extends React.InputHTMLAttributes<HTMLInputElement> {

}

export const Input = React.forwardRef<HTMLInputElement, InputProps>(
  ({ className = '', ...props }, ref) => {
    return (
      <input
        ref={ref}
        className={`w-full rounded h-[46px] px-4 text-gray-700 bg-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-[#E6C200] text-sm transition-all ${className}`}
        {...props}
      />
    );
  }
);
Input.displayName = 'Input';


========================================
RUTA: frontend\src\components\atoms\Toast.tsx
========================================
import { useEffect } from 'react';
import { X, CheckCircle, AlertCircle, Info } from 'lucide-react';


export type ToastType = 'success' | 'error' | 'info';

interface ToastProps {
  id: number;
  message: string;
  type: ToastType;
  onClose: (id: number) => void;
}

export const Toast = ({ id, message, type, onClose }: ToastProps) => {
  useEffect(() => {
    // Auto-cierre a los 4 segundos
    const timer = setTimeout(() => {
      onClose(id);
    }, 4000);

    return () => clearTimeout(timer);
  }, [id, onClose]);

  const styles = {
    success: "bg-white border-green-500 text-gray-800 shadow-[0_4px_12px_rgba(34,197,94,0.15)]",
    error: "bg-white border-red-500 text-gray-800 shadow-[0_4px_12px_rgba(239,68,68,0.15)]",
    info: "bg-white border-blue-500 text-gray-800 shadow-[0_4px_12px_rgba(59,130,246,0.15)]"
  };

  const icons = {
    success: <CheckCircle size={20} className="text-green-500" />,
    error: <AlertCircle size={20} className="text-red-500" />,
    info: <Info size={20} className="text-blue-500" />
  };

  return (
    <div className={`flex items-center gap-3 px-4 py-4 rounded-lg border-l-4 min-w-[320px] mb-3 transition-all animate-[slideIn_0.3s_ease-out] relative bg-white border border-gray-100 ${styles[type]}`}>
      {icons[type]}
      <div className="flex-1">
        <p className="text-sm font-semibold">{message}</p>
      </div>
      <button 
        onClick={() => onClose(id)} 
        className="text-gray-400 hover:text-gray-600 transition-colors"
      >
        <X size={16} />
      </button>
    </div>
  );
};


========================================
RUTA: frontend\src\components\molecules\PasswordField.tsx
========================================
import React, { useState } from 'react';
import { Eye, EyeOff } from 'lucide-react';
import { Input } from '../atoms/Input';

interface PasswordFieldProps extends React.InputHTMLAttributes<HTMLInputElement> {}

export const PasswordField = (props: PasswordFieldProps) => {
  const [show, setShow] = useState(false);

  return (
    <div className="relative">
      <Input
        type={show ? "text" : "password"}
        className="pr-12"
        {...props}
      />
      <button
        type="button"
        onClick={() => setShow(!show)}
        className="absolute right-4 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700"
      >
        {show ? <EyeOff size={20} /> : <Eye size={20} />}
      </button>
    </div>
  );
};


========================================
RUTA: frontend\src\components\organisms\AddEmpresaForm.tsx
========================================
import React, { useState } from 'react';
import { Input } from '../atoms/Input';
import { Button } from '../atoms/Button';
import { createEmpresa } from '../../services/empresaService';

interface Props {
  onSuccess: () => void;
  onCancel: () => void;
}

export const AddEmpresaForm = ({ onSuccess, onCancel }: Props) => {
  const [formData, setFormData] = useState({ nit: '', nombre: '', direccion: '', telefono: '' });
  const [error, setError] = useState<string | null>(null);
  const [loading, setLoading] = useState(false);

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setLoading(true);
    setError(null);

    try {
      await createEmpresa(formData);
      onSuccess();
      setFormData({ nit: '', nombre: '', direccion: '', telefono: '' }); // Limpiar
    } catch (err: any) {
      console.error(err);
      if (err.response?.status === 403) {
        setError("No tienes permisos de Administrador para crear empresas.");
      } else {
        setError("Error al crear empresa. Revisa el NIT (puede que ya exista).");
      }
    } finally {
      setLoading(false);
    }
  };

  return (
    <div className="bg-gray-50 p-6 rounded-lg border border-gray-200 mb-6">
      <h3 className="text-lg font-bold text-gray-800 mb-4">Nueva Empresa</h3>
      
      {error && <div className="mb-4 p-3 bg-red-100 text-red-700 text-sm rounded">{error}</div>}

      <form onSubmit={handleSubmit} className="grid grid-cols-1 md:grid-cols-2 gap-4">
        <Input 
          placeholder="NIT" 
          value={formData.nit}
          onChange={e => setFormData({...formData, nit: e.target.value})}
          required 
        />
        <Input 
          placeholder="Nombre Empresa" 
          value={formData.nombre}
          onChange={e => setFormData({...formData, nombre: e.target.value})}
          required 
        />
        <Input 
          placeholder="DirecciÃ³n" 
          value={formData.direccion}
          onChange={e => setFormData({...formData, direccion: e.target.value})}
          required 
        />
        <Input 
          placeholder="TelÃ©fono" 
          value={formData.telefono}
          onChange={e => setFormData({...formData, telefono: e.target.value})}
          required 
        />

        <div className="md:col-span-2 flex gap-3 mt-2">
           <Button type="button"  onClick={onCancel} className="bg-gray-300 hover:bg-gray-400 text-gray-800">
            Cancelar
          </Button>
          <Button type="submit" variant="primary" disabled={loading}>
            {loading ? "Guardando..." : "Guardar Empresa"}
          </Button>
        </div>
      </form>
    </div>
  );
};



========================================
RUTA: frontend\src\components\organisms\AddProductForm.tsx
========================================
import React, { useState } from 'react';
import { Input } from '../atoms/Input';
import { Button } from '../atoms/Button';
import { createProducto, generarDescripcionIA } from '../../services/productoService';
import { Wand2 } from 'lucide-react';
import { useToast } from '../../context/ToastContext';

interface Props {
  empresaNit: string;
  onSuccess: () => void;
  onCancel: () => void;
}

export const AddProductForm = ({ empresaNit, onSuccess, onCancel }: Props) => {
  const { showToast } = useToast();

  const [formData, setFormData] = useState({ 
    codigo: '', 
    nombre: '', 
    caracteristicas: '',
    moneda: 'USD',
    precio: ''
  });
  
  const [loading, setLoading] = useState(false);
  const [generatingAI, setGeneratingAI] = useState(false);

  const handleAI = async () => {
    if (!formData.nombre) {
        showToast("Escribe un nombre de producto primero", 'info');
        return;
    }
    
    setGeneratingAI(true);
    try {
      const desc = await generarDescripcionIA(formData.nombre);
      setFormData(prev => ({ ...prev, caracteristicas: desc }));
      showToast("DescripciÃ³n generada con IA", 'success');
    } catch (err) {
      showToast("Error contactando a la IA", 'error');
    } finally {
      setGeneratingAI(false);
    }
  };

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setLoading(true);

    try {
      // objeto JSON de precios
      const preciosJSON = {
        [formData.moneda]: parseFloat(formData.precio)
      };

      await createProducto({
        codigo: formData.codigo,
        nombre: formData.nombre,
        caracteristicas: formData.caracteristicas,
        empresa: empresaNit,
        precios: preciosJSON
      });
      
      showToast("Producto creado exitosamente", 'success'); 
    } catch (err) {
      showToast("Error al guardar. Revisa que el cÃ³digo no estÃ© repetido.", 'error');
      console.error(err);
    } finally {
      setLoading(false);
    }
  };

  return (
    <div className="bg-gray-50 p-6 rounded-lg border border-gray-200 mb-6 animate-[fadeIn_0.3s_ease-out]">
      <h3 className="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2">
         Nuevo Producto
      </h3>
      
      <form onSubmit={handleSubmit} className="grid grid-cols-1 md:grid-cols-2 gap-4">
        <Input 
          placeholder="CÃ³digo Ãšnico" 
          value={formData.codigo}
          onChange={e => setFormData({...formData, codigo: e.target.value})}
          required 
        />
        <Input 
          placeholder="Nombre Producto" 
          value={formData.nombre}
          onChange={e => setFormData({...formData, nombre: e.target.value})}
          required 
        />
        
        {/* SecciÃ³n IA */}
        <div className="md:col-span-2 relative group">
          <textarea
            className="w-full p-3 pr-36 rounded border border-gray-200 focus:outline-none focus:ring-2 focus:ring-[#E6C200] text-sm resize-none transition-all"
            rows={3}
            placeholder="CaracterÃ­sticas (Escribe manual o usa la IA â†’)"
            value={formData.caracteristicas}
            onChange={e => setFormData({...formData, caracteristicas: e.target.value})}
            required
          />
          <button
            type="button"
            onClick={handleAI}
            disabled={generatingAI}
            className="absolute top-3 right-3 flex items-center gap-1 bg-purple-600 text-white text-xs px-3 py-1.5 rounded-md hover:bg-purple-700 disabled:opacity-50 shadow-sm transition-all hover:shadow-md z-10"
          >
            <Wand2 size={12} className={generatingAI ? "animate-spin" : ""} />
            {generatingAI ? "Generando..." : "Generar con IA"}
          </button>
        </div>

        {/* Precios */}
        <div className="flex gap-2">
            <select 
                className="rounded border border-gray-200 px-3 text-sm bg-white focus:outline-none focus:ring-2 focus:ring-[#E6C200]"
                value={formData.moneda}
                onChange={e => setFormData({...formData, moneda: e.target.value})}
            >
                <option value="USD">USD</option>
                <option value="COP">COP</option>
                <option value="EUR">EUR</option>
            </select>
            <Input 
                placeholder="Precio" 
                type="number"
                value={formData.precio}
                onChange={e => setFormData({...formData, precio: e.target.value})}
                required 
            />
        </div>

        <div className="md:col-span-2 flex gap-3 mt-2 justify-end">
           <Button type="button" onClick={onCancel} className="bg-gray-200 hover:bg-gray-300 w-auto px-4 text-gray-700 border border-gray-300">
            Cancelar
          </Button>
          <Button type="submit" variant="primary" disabled={loading} className="w-auto px-6 shadow-sm">
            {loading ? "Guardando..." : "Guardar Producto"}
          </Button>
        </div>
      </form>
    </div>
  );
};


========================================
RUTA: frontend\src\components\organisms\EmpresaList.tsx
========================================
import { useEffect, useState } from 'react';
import { getEmpresas, type Empresa } from '../../services/empresaService';
import { useNavigate } from 'react-router-dom';

interface EmpresaListProps {
  refreshTrigger: number;
}

export const EmpresaList = ({ refreshTrigger }: EmpresaListProps) => {
  const [empresas, setEmpresas] = useState<Empresa[]>([]);
  const [loading, setLoading] = useState(true);
  const navigate = useNavigate();

  useEffect(() => {
    cargarEmpresas();
  }, [refreshTrigger]);

  const cargarEmpresas = async () => {
    try {
      const data = await getEmpresas();
      setEmpresas(data);
    } catch (err) {
      console.error(err);
    } finally {
      setLoading(false);
    }
  };

  if (loading) return <div className="p-4 text-center">Cargando empresas...</div>;

  return (
    <div className="overflow-x-auto bg-white rounded-lg shadow">
      <table className="min-w-full divide-y divide-gray-200">
        <thead className="bg-gray-50">
          <tr>
            <th className="px-6 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">NIT</th>
            <th className="px-6 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">NOMBRE</th>
            <th className="px-6 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">ACCIÃ“N</th>
          </tr>
        </thead>
        <tbody className="bg-white divide-y divide-gray-200">
          {empresas.map((empresa) => (
            <tr key={empresa.nit} className="hover:bg-gray-50">
              <td className="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">{empresa.nit}</td>
              <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{empresa.nombre}</td>
              <td className="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                <button 
                  onClick={() => navigate(`/dashboard/empresa/${empresa.nit}`)}
                  className="text-[#d8b600] hover:text-[#bfa100] font-bold"
                >
                  Ver Inventario â†’
                </button>
              </td>
            </tr>
          ))}
          {empresas.length === 0 && (
            <tr>
              <td colSpan={3} className="px-6 py-8 text-center text-gray-500">
                No hay empresas registradas.
              </td>
            </tr>
          )}
        </tbody>
      </table>
    </div>
  );
};


========================================
RUTA: frontend\src\components\organisms\LoginForm.tsx
========================================
import React, { useState } from 'react';
import { Input } from '../atoms/Input';
import { Button } from '../atoms/Button';
import { PasswordField } from '../molecules/PasswordField';
import { login as LoginService } from '../../services/authService'; 
import { useAuth } from '../../context/AuthContext';
import { useNavigate } from 'react-router-dom';

export const LoginForm = () => {
  const [email, setEmail] = useState("");
  const [password, setPassword] = useState("");
  const [error, setError] = useState<string | null>(null);
  const [loading, setLoading] = useState(false);

  const { login } = useAuth(); 
  const navigate = useNavigate();

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setError(null);
    setLoading(true);

    try {
      const data = await LoginService(email, password);
      
      // AQUI EL CAMBIO: Pasamos el token Y el estado de admin
      login(data.access, data.is_admin);
      
      navigate('/dashboard');
      
    } catch (err: any) {
      console.error("Error login:", err);

      if (err.response?.status === 401) {
        setError("Correo o contraseÃ±a incorrectos.");
      } else {
        setError("Error de conexiÃ³n. Intente mÃ¡s tarde.");
      }
    } finally {
      setLoading(false);
    }
  };

  return (
    <form onSubmit={handleSubmit} className="flex flex-col gap-3">
      {error && (
        <div className="bg-red-500/20 border border-red-500 text-red-100 text-xs p-2 rounded text-center">
          {error}
        </div>
      )}

      <Input
        type="email"
        value={email}
        onChange={(e) => setEmail(e.target.value)}
        placeholder="Correo electrÃ³nico"
        required
      />
      
      <PasswordField 
        value={password} 
        onChange={(e) => setPassword(e.target.value)}
        placeholder="ContraseÃ±a"
        required
      />

      <Button type="submit" variant="primary" disabled={loading} className='mt-2'>
        {loading ? "Cargando..." : "Inicia sesiÃ³n"}
      </Button>
    </form>
  );
};


========================================
RUTA: frontend\src\components\organisms\RegisterForm.tsx
========================================
import React, { useState } from 'react';
import { Input } from '../atoms/Input';
import { Button } from '../atoms/Button';
import { PasswordField } from '../molecules/PasswordField';
import { register } from '../../services/authService';
import { useNavigate } from 'react-router-dom';
import { useToast } from '../../context/ToastContext'; 

export const RegisterForm = () => {
  const { showToast } = useToast(); 
  const navigate = useNavigate();

  const [email, setEmail] = useState("");
  const [password, setPassword] = useState("");
  const [confirmPass, setConfirmPass] = useState("");
  const [loading, setLoading] = useState(false);

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    
    if (password !== confirmPass) {
      showToast("Las contraseÃ±as no coinciden", 'error'); 
      return;
    }

    setLoading(true);

    try {
      await register(email, password);
      showToast("Â¡Cuenta creada! Inicia sesiÃ³n ahora.", 'success');
      navigate('/login');
    } catch (err: any) {
      console.error("Error registro:", err);

      const msg = err.response?.data?.email?.[0] || "Error al registrarse. Intente nuevamente.";
      
      showToast(msg, 'error');
    } finally {
      setLoading(false);
    }
  };

  return (
    <form onSubmit={handleSubmit} className="flex flex-col gap-3">
      
      <Input
        type="email"
        value={email}
        onChange={(e) => setEmail(e.target.value)}
        placeholder="Correo electrÃ³nico"
        required
      />
      
      <PasswordField 
        value={password} 
        onChange={(e) => setPassword(e.target.value)}
        placeholder="ContraseÃ±a"
        required
      />

      <PasswordField 
        value={confirmPass} 
        onChange={(e) => setConfirmPass(e.target.value)}
        placeholder="Confirmar ContraseÃ±a"
        required
      />

      <Button type="submit" variant="primary" disabled={loading} className='mt-2'>
        {loading ? "Creando cuenta..." : "Crear Cuenta"}
      </Button>
    </form>
  );
};


========================================
RUTA: frontend\src\components\organisms\SocialLogin.tsx
========================================
import { Button } from '../atoms/Button';

export const SocialLogin = () => {
    const GoogleIcon = (
        <svg viewBox="0 0 24 24" className="w-full h-full"><path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="#4285F4"/><path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/><path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"/><path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/></svg>
    );

    const FacebookIcon = (
        <svg viewBox="0 0 24 24" className="w-full h-full" fill="#1877F2"><path d="M9 8h-3v4h3v12h5v-12h3.642l.358-4h-4v-1.667c0-.955.192-1.333 1.115-1.333h2.885v-5h-3.808c-3.596 0-5.192 1.583-5.192 4.615v3.385z"/></svg>
    );

    return (
        <div className="flex flex-col gap-3">
            <Button variant="social" icon={GoogleIcon}>
                Google
            </Button>
            <Button variant="social" icon={FacebookIcon}>
                Facebook
            </Button>
        </div>
    );
}


========================================
RUTA: frontend\src\components\templates\AuthTemplate.tsx
========================================
import React from 'react';
import { Globe } from 'lucide-react';

interface AuthTemplateProps {
  children: React.ReactNode;
}

export const AuthTemplate = ({ children }: AuthTemplateProps) => {
  return (
    <div className="relative min-h-screen w-full bg-[#0d0d0d] font-sans text-white overflow-hidden">
      {/* Background */}
      <div className="absolute inset-0 z-0 bg-cover bg-center" style={{ backgroundImage: "url('/dark-circuit-board-pattern-with-golden-padlock-sec.jpg')" }} />
      <div className="absolute inset-0 z-10 bg-black/40" />

      {/* Idioma */}
      <div className="absolute top-4 right-6 z-30 flex items-center gap-2 text-sm text-white cursor-pointer hover:text-gray-300">
        <Globe size={16} />
        <span>EspaÃ±ol</span>
      </div>

      {/* Main Container */}
      <div className="relative z-20 flex min-h-screen flex-col items-center justify-center px-4">
        {/* LOGO */}
        <div className="mb-6 flex flex-col items-center select-none">
          <div className="text-4xl font-bold tracking-tight text-white flex items-baseline">
            <span>Creden</span>
            <span className="text-[#E6C200] relative">
              t<span className="absolute -top-1 left-0 w-full h-0.5 bg-[#E6C200]"></span>
            </span>
            <span>ials</span>
          </div>
          <div className="text-[9px] tracking-[0.2em] text-white/80 mt-0.5">by Nicklcs</div>
        </div>

        {/* Card Content*/}
        <div className="w-full max-w-[380px]">
             {children}
        </div>
      </div>
    </div>
  );
};


========================================
RUTA: frontend\src\context\AuthContext.tsx
========================================
import React, { createContext, useContext, useState, useEffect } from 'react';

interface AuthContextType {
  isAuthenticated: boolean;
  isAdmin: boolean;
  login: (token: string, isAdminRole: boolean) => void;
  logout: () => void;
  isLoading: boolean;
}

const AuthContext = createContext<AuthContextType | undefined>(undefined);

export const AuthProvider = ({ children }: { children: React.ReactNode }) => {
  const [isAuthenticated, setIsAuthenticated] = useState(false);
  const [isAdmin, setIsAdmin] = useState(false);
  const [isLoading, setIsLoading] = useState(true);

  useEffect(() => {
    const token = localStorage.getItem('access_token');
    const storedIsAdmin = localStorage.getItem('is_admin') === 'true'; 
    
    if (token) {
      setIsAuthenticated(true);
      setIsAdmin(storedIsAdmin);
    }
    setIsLoading(false);
  }, []);

  const login = (token: string, isAdminRole: boolean) => {
    localStorage.setItem('access_token', token);
    localStorage.setItem('is_admin', String(isAdminRole));
    setIsAuthenticated(true);
    setIsAdmin(isAdminRole);
  };

  const logout = () => {
    localStorage.removeItem('access_token');
    localStorage.removeItem('refresh_token');
    localStorage.removeItem('is_admin');
    setIsAuthenticated(false);
    setIsAdmin(false);
  };

  return (
    <AuthContext.Provider value={{ isAuthenticated, isAdmin, login, logout, isLoading }}>
      {children}
    </AuthContext.Provider>
  );
};

export const useAuth = () => {
  const context = useContext(AuthContext);
  if (!context) throw new Error('useAuth debe usarse dentro de un AuthProvider');
  return context;
};


========================================
RUTA: frontend\src\context\ToastContext.tsx
========================================
import React, { createContext, useContext, useState } from 'react';
import { Toast, type ToastType } from '../components/atoms/Toast';

interface ToastContextType {
  showToast: (message: string, type: ToastType) => void;
}

const ToastContext = createContext<ToastContextType | undefined>(undefined);

export const ToastProvider = ({ children }: { children: React.ReactNode }) => {
  const [toasts, setToasts] = useState<{ id: number; message: string; type: ToastType }[]>([]);

  const showToast = (message: string, type: ToastType) => {
    const id = Date.now();
    setToasts((prev) => [...prev, { id, message, type }]);
  };

  const removeToast = (id: number) => {
    setToasts((prev) => prev.filter((t) => t.id !== id));
  };

  return (
    <ToastContext.Provider value={{ showToast }}>
      {children}
      {/* Contenedor Flotante (Portal) */}
      <div className="fixed top-6 right-6 z-[9999] flex flex-col items-end pointer-events-none">
        <div className="pointer-events-auto"> {/* Habilita clicks solo en los toasts */}
          {toasts.map((t) => (
            <Toast 
              key={t.id} 
              id={t.id} 
              message={t.message} 
              type={t.type} 
              onClose={removeToast} 
            />
          ))}
        </div>
      </div>
    </ToastContext.Provider>
  );
};

export const useToast = () => {
  const context = useContext(ToastContext);
  if (!context) throw new Error('useToast debe usarse dentro de un ToastProvider');
  return context;
};


========================================
RUTA: frontend\src\pages\Dashboard.tsx
========================================
import { useState } from 'react';
import { useAuth } from '../context/AuthContext';
import { Button } from '../components/atoms/Button';
import { EmpresaList } from '../components/organisms/EmpresaList';
import { AddEmpresaForm } from '../components/organisms/AddEmpresaForm';

export default function Dashboard() {
  const { logout, isAdmin } = useAuth();
  const [showForm, setShowForm] = useState(false);
  const [refreshList, setRefreshList] = useState(0);

  return (
    <div className="min-h-screen bg-gray-100 p-4 font-sans">
      <div className="max-w-5xl mx-auto">
        
        {/* Header */}
        <header className="flex flex-col md:flex-row justify-between items-center mb-8 bg-white p-6 rounded-xl shadow-sm">
          <div>
            <h1 className="text-2xl font-bold text-gray-800 tracking-tight">Panel de Control</h1>
            <p className="text-gray-500 text-sm">Sistema de Inventario</p>
          </div>
          <div className="mt-4 md:mt-0">
            <Button onClick={logout} className="bg-red-50 text-red-600 hover:bg-red-100 w-auto px-6 h-[40px]">
              Cerrar SesiÃ³n
            </Button>
          </div>
        </header>

        {/* Content */}
        <main>
          <div className="flex justify-between items-center mb-6">
            <h2 className="text-xl font-bold text-gray-700 border-l-4 border-[#E6C200] pl-3">
              Empresas Registradas
            </h2>
            
            {/* CONDICIONAL ADMIN */}
            {!showForm && isAdmin && (
              <div className="w-48">
                <Button onClick={() => setShowForm(true)} variant="primary">
                  + Nueva Empresa
                </Button>
              </div>
            )}
          </div>

          {/* Formulario (Condicional) */}
          {showForm && (
            <AddEmpresaForm 
              onSuccess={() => {
                setShowForm(false);
                setRefreshList(prev => prev + 1); // Recargo tobla
              }}
              onCancel={() => setShowForm(false)}
            />
          )}

          {/* Tabla */}
          <EmpresaList refreshTrigger={refreshList} />
        </main>

      </div>
    </div>
  );
}


========================================
RUTA: frontend\src\pages\InventoryPage.tsx
========================================
import { useEffect, useState } from 'react';
import { useParams, useNavigate } from 'react-router-dom';
import { getProductos, downloadPDF, sendEmailReport, type Producto } from '../services/productoService';
import { getEmpresaByNit, type Empresa } from '../services/empresaService'; 
import { Button } from '../components/atoms/Button';
import { AddProductForm } from '../components/organisms/AddProductForm';
import { useAuth } from '../context/AuthContext';
import { FileText, ArrowLeft, Mail, Send } from 'lucide-react'; 
import { useToast } from '../context/ToastContext';

export default function InventoryPage() {
  const { nit } = useParams();
  const navigate = useNavigate();
  const { isAdmin } = useAuth();
  
  const { showToast } = useToast();
  
  // Estado
  const [productos, setProductos] = useState<Producto[]>([]);
  const [empresaInfo, setEmpresaInfo] = useState<Empresa | null>(null);
  const [loading, setLoading] = useState(true);
  const [showForm, setShowForm] = useState(false);
  const [sendingEmail, setSendingEmail] = useState(false);

  useEffect(() => {
    if (nit) {
        cargarDataCompuesto();
    }
  }, [nit]);

  const cargarDataCompuesto = async () => {
    setLoading(true);
    try {

      const [empresaData, allProductos] = await Promise.all([
        getEmpresaByNit(nit!),
        getProductos()
      ]);
      
      setEmpresaInfo(empresaData);

      const filtrados = allProductos.filter(p => String(p.empresa) === String(nit));
      setProductos(filtrados);

    } catch (error) {
      console.error(error);
      showToast("Error cargando el inventario de la empresa", 'error');
    } finally {
      setLoading(false);
    }
  };
  
  const handleSendEmail = async () => {
    const email = prompt("Ingrese el correo destino:", "usuario@ejemplo.com");
    if (!email) return;

    setSendingEmail(true);
    try {
        await sendEmailReport(email);
        showToast(`Reporte enviado correctamente a ${email}`, 'success'); 
    } catch (error) {
        console.error(error);
        showToast("Hubo un error enviando el correo. Verifique la consola.", 'error');
    } finally {
        setSendingEmail(false);
    }
  };

  const handleDownloadPDF = async () => {
      try {
          await downloadPDF();
          showToast("Descarga de PDF iniciada", 'info');
      } catch (e) {
          showToast("Error descargando el PDF", 'error');
      }
  }

  return (
    <div className="min-h-screen bg-gray-100 p-4 md:p-8">
      <div className="max-w-6xl mx-auto">
        <Button 
            onClick={() => navigate('/dashboard')} 
            className="w-auto px-4 mb-4 bg-white hover:bg-gray-50 text-gray-600 border border-gray-200"
            icon={<ArrowLeft size={16}/>}
        >
            Volver a Empresas
        </Button>

        <header className="flex justify-between items-center mb-6 bg-white p-6 rounded-lg shadow-sm animate-[fadeIn_0.5s_ease-out]">
          <div>
            <h1 className="text-xl font-bold text-gray-800">
               {empresaInfo ? `Inventario: ${empresaInfo.nombre}` : 'Cargando empresa...'}
            </h1>
            <p className="text-gray-500 text-sm">
                NIT: {nit} {empresaInfo && `â€¢ Tel: ${empresaInfo.telefono}`}
            </p>
          </div>
          <div className="flex gap-2">
            <Button onClick={handleDownloadPDF} className="w-auto px-4 bg-red-600 hover:bg-red-700 text-white" icon={<FileText size={16}/>}>
                PDF Global
            </Button>

            <Button 
                onClick={handleSendEmail} 
                className="w-auto px-4 bg-blue-600 hover:bg-blue-700 text-white" 
                disabled={sendingEmail}
                icon={sendingEmail ? <Send size={16} className="animate-pulse"/> : <Mail size={16}/>}
            >
                {sendingEmail ? 'Enviando...' : 'Enviar Reporte'}
            </Button>
            
            {/* CONDICIONAL: Solo Admin puede crear productos */}
            {isAdmin && (
                <Button onClick={() => setShowForm(!showForm)} variant="primary" className="w-auto px-4">
                    {showForm ? 'Cerrar Formulario' : '+ Agregar Producto'}
                </Button>
            )}
          </div>
        </header>

        {showForm && (
            <AddProductForm 
                empresaNit={nit!} 
                onSuccess={() => {
                    cargarDataCompuesto();
                    setShowForm(false);
                }} 
                onCancel={() => setShowForm(false)} 
            />
        )}

        {/* Tabla de Productos */}
        <div className="bg-white rounded-lg shadow overflow-hidden">
            {loading ? <div className="p-12 text-center text-gray-500">Cargando datos...</div> : (
                <table className="min-w-full divide-y divide-gray-200">
                    <thead className="bg-gray-50">
                        <tr>
                            <th className="px-6 py-3 text-left text-xs font-bold text-gray-500 uppercase">CÃ³digo</th>
                            <th className="px-6 py-3 text-left text-xs font-bold text-gray-500 uppercase">Producto</th>
                            <th className="px-6 py-3 text-left text-xs font-bold text-gray-500 uppercase">CaracterÃ­sticas</th>
                            <th className="px-6 py-3 text-left text-xs font-bold text-gray-500 uppercase">Precio</th>
                        </tr>
                    </thead>
                    <tbody className="divide-y divide-gray-200">
                        {productos.map(prod => (
                            <tr key={prod.id} className="hover:bg-gray-50 transition-colors">
                                <td className="px-6 py-4 text-sm font-medium text-gray-900">{prod.codigo}</td>
                                <td className="px-6 py-4 text-sm text-gray-600">{prod.nombre}</td>
                                <td className="px-6 py-4 text-xs text-gray-500 max-w-xs">{prod.caracteristicas}</td>
                                <td className="px-6 py-4 text-sm font-bold text-green-600">
                                    
                                    {Object.entries(prod.precios).map(([moneda, valor]) => (
                                        <div key={moneda} className="whitespace-nowrap">{moneda} ${valor.toLocaleString()}</div>
                                    ))}
                                </td>
                            </tr>
                        ))}
                         {productos.length === 0 && (
                            <tr>
                                <td colSpan={4} className="p-10 text-center text-gray-400">
                                    <div className="flex flex-col items-center gap-2">
                                        <FileText size={32} className="opacity-20"/>
                                        <p>Esta empresa no tiene productos registrados aÃºn.</p>
                                    </div>
                                </td>
                            </tr>
                        )}
                    </tbody>
                </table>
            )}
        </div>
      </div>
    </div>
  );
}


========================================
RUTA: frontend\src\pages\Login.tsx
========================================
import { AuthTemplate } from '../components/templates/AuthTemplate';
import { LoginForm } from '../components/organisms/LoginForm';
import { SocialLogin } from '../components/organisms/SocialLogin';

export default function Login() {
  return (
    <AuthTemplate>
      <h2 className="mb-6 text-center text-xl font-bold text-white">Bienvenido de nuevo</h2>

      <LoginForm />

      <div className="mt-4 text-center">
        <a href="#" className="text-sm font-semibold text-white hover:underline hover:text-[#E6C200]">
          Crea tu nueva contraseÃ±a ahora
        </a>
      </div>

      <div className="mt-4 text-center text-sm text-white">
        Â¿AÃºn no tienes tu cuenta Lite Thinking?
        <br />
        <a href="/register" className="font-bold hover:text-[#E6C200] underline">
          Crea tu cuenta
        </a>
      </div>

      <div className="mt-6 mb-4 text-center text-sm text-gray-300">
          O inicia sesiÃ³n usando:
      </div>

      <SocialLogin />
    </AuthTemplate>
  );
}


========================================
RUTA: frontend\src\pages\Register.tsx
========================================
import { AuthTemplate } from '../components/templates/AuthTemplate';
import { RegisterForm } from '../components/organisms/RegisterForm';
import { Link } from 'react-router-dom';

export default function Register() {
  return (
    <AuthTemplate>
      <h2 className="mb-6 text-center text-xl font-bold text-white">Crea tu cuenta</h2>

      <RegisterForm />

      <div className="mt-6 text-center text-sm text-gray-300">
        Â¿Ya tienes cuenta?
        <br />
        <Link to="/login" className="font-bold hover:text-[#E6C200] underline ml-1">
          Inicia sesiÃ³n aquÃ­
        </Link>
      </div>
    </AuthTemplate>
  );
}


========================================
RUTA: frontend\src\services\api.ts
========================================
import axios from 'axios';

const api = axios.create({
  baseURL: 'http://127.0.0.1:8000/api/',
  timeout: 5000,
  headers: {
    'Content-Type': 'application/json',
  },
});

api.interceptors.request.use(
  (config) => {
    const token = localStorage.getItem('access_token');
    if (token) {
      config.headers.Authorization = `Bearer ${token}`;
    }
    return config;
  },
  (error) => Promise.reject(error)
);

export default api;


========================================
RUTA: frontend\src\services\authService.ts
========================================
import api from './api';


interface LoginResponse {
  access: string;
  refresh: string;
  is_admin: boolean;
}

export const login = async (email: string, password: string): Promise<LoginResponse> => {
    const response = await api.post<LoginResponse>('auth/login/', { email, password });
    return response.data;
};
export const register = async (email: string, password: string): Promise<any> => {
    const response = await api.post('auth/register/', { email, password });
    return response.data;
};


========================================
RUTA: frontend\src\services\empresaService.ts
========================================
import api from './api';

export interface Empresa {
  nit: string;
  nombre: string;
  direccion: string;
  telefono: string;
}

export const getEmpresas = async (): Promise<Empresa[]> => {
  const response = await api.get<Empresa[]>('empresas/');
  return response.data;
};

export const getEmpresaByNit = async (nit: string): Promise<Empresa> => {
  const response = await api.get<Empresa>(`empresas/${nit}/`);
  return response.data;
};

export const createEmpresa = async (data: Empresa): Promise<Empresa> => {
  const response = await api.post<Empresa>('empresas/', data);
  return response.data;
};


========================================
RUTA: frontend\src\services\productoService.ts
========================================
import api from './api';

export interface Producto {
  id?: number;
  codigo: string;
  nombre: string;
  caracteristicas: string;
  empresa: string;
  precios: Record<string, number>;
}

export const getProductos = async (): Promise<Producto[]> => {
  const response = await api.get<Producto[]>('productos/');
  return response.data;
};

export const createProducto = async (data: Producto): Promise<Producto> => {
  const response = await api.post<Producto>('productos/', data);
  return response.data;
};

export const generarDescripcionIA = async (nombre: string): Promise<string> => {
  const response = await api.post<{ descripcion: string }>('productos/generar_descripcion/', {
    nombre: nombre,
    caracteristicas: 'Genera una descripciÃ³n comercial atractiva'
  });
  return response.data.descripcion;
};

export const downloadPDF = async () => {

  const response = await api.get('productos/descargar_reporte/', {
    responseType: 'blob', 
  });

  const url = window.URL.createObjectURL(new Blob([response.data]));
  
  const link = document.createElement('a');
  link.href = url;
  link.setAttribute('download', 'inventario_reporte.pdf'); 
  
  document.body.appendChild(link);
  link.click();
  link.remove();
  window.URL.revokeObjectURL(url);
};

export const sendEmailReport = async (email: string) => {
  const response = await api.post('productos/enviar_reporte_email/', {
    email: email
  });
  return response.data;
};
